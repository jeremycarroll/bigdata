<?xml version="1.0"?>
<project default="install" xmlns:j="jelly:core">

<!-- Conditionally disable linkcheck based on a property. -->
<postGoal name="xdoc:register-reports"> 
  <j:if test="${maven.linkcheck.disable}">
    <attainGoal name="maven-linkcheck-plugin:deregister"/> 
    <echo>linkcheck is disabled.</echo>
  </j:if>
</postGoal>

<!-- Conditionally disable javadoc based on a property. -->
<postGoal name="xdoc:register-reports"> 
  <j:if test="${maven.javadoc.disable}">
    <attainGoal name="maven-javadoc-plugin:deregister"/> 
    <echo>javadoc is disabled.</echo>
  </j:if>
</postGoal>

<!-- Check property setup before running multiproject:xxx goals. -->
<preGoal name="multiproject:install">
   <attainGoal name="multiprojectPropertyCheck"/>
</preGoal>
<preGoal name="multiproject:site">
   <attainGoal name="multiprojectPropertyCheck"/>
</preGoal>

<!-- This is the preferred method for (un)registering select reports. -->
<!-- It is being used here to register for the dependency convergence -->
<!-- report for the multiproject site goal. -->

<postGoal name="xdoc:register-reports">

  <!--<attainGoal name="maven-changelog-plugin:deregister"/>-->
  <!--<attainGoal name="maven-myown-plugin:register"/>-->

  <!-- Register the multiproject report for dependency convergence. -->
  <attainGoal name="maven-multiproject-plugin:register"/>

</postGoal>

<!-- -->
<!-- The "maven.multiproject.basedir" property MUST be defined. -->
<!-- -->
<goal name="multiprojectPropertyCheck">
  <j:set var="dir" value="${maven.multiproject.basedir}"/>
  <echo>
     user.home = [${user.home}]
     basedir = [${basedir}]
     maven.multiproject.basedir = [${maven.multiproject.basedir}]
  </echo>
  <j:if test="${dir.length() == 0 || dir == null}">
       <echo>

            You MUST specify the 'maven.multiproject.basedir' property.
	    
	    This property should be the fully qualified path of the
	    directory ABOVE the bigdata-master-pom module.  You can specify this
	    property either by using '-D' on the maven command line or
	    by editing your ~/build.properties file.

       </echo>
       <fail/>
   </j:if>
</goal>
  
</project>
