<html>
<head>
<title>Release - How To</title>
</head>
<body>

<h1>bigdata - Release How To</h1>

<p>

    This page provides some documentation concerning the release
    "procedures" for <a href="http://www.sourceforge.net/projects/bigdata">
    bigdata</a> modules.

</p>

<hr>

<h3>Prepare:</h3>

   <ol>

   <li> <strong> Commit </strong> any final changes.  Make sure that
        the CVS repository is current for the module in question and
        that there are no files which should be part of the CVS
        repository which still need to be added (cvs -add) to the
        repository.  Coordinate with others to make sure that nobody
        else is touching the repository for that module. </li>

   <li> <strong> Clean </strong> the target directory ("maven clean").
        This helps make sure that all classes will compile correctly
        from the source.  A <strong> MUCH </strong> safer test is to
        do a clean checkout of the module (which is what you get from
        the nightly build report). </li>

   <li> <strong> Test </strong> the module ("mtest", or "mtestui" if
        you need to examine individual test results).  Sometimes you
        need to release a module with test failures, but don't do this
        without good reason.  (The "msite" command runs the tests and
        also generate a nice report that you can examine.  You can
        also just navigate to the module from the <a
        href="http://www.bigdata.com/projects/bigdata"> bigdata
        project site </a>, in which case you should also take a moment
        to browse the documentation and make sure that it is all up to
        snuff.) </li>

   <li> Write up an <strong> Announcement </strong>.  The annoucement
        goes in the <code> src/announcements </code> directory for the
        CVS module.  <strong> Add </strong> the announcement to CVS
        (cvs -add) and <strong> commit </strong> the file (cvs
        -commit).  You will need this file later when you actually
        release the module on SourceForge. </li>

   <li> Generate a <strong> Change Log </strong>.  You will need this
        file later when you actually release the module on
        SourceForge.  (The "msite" command SHOULD generate a Change
        Log, but that only works for the nightly build on SourceForge
        - see <code> bigdata-master-pom/project.xml </code> for details on this
        issue.)

   </li><li> <p><strong> Install artifacts in your local Maven repository
        </strong> ("m(n)install").  If you forget this step, then
        other modules that you build on your system will be using the
        wrong artifacts.  This can mess up your entire release since
        you may fail to uncover broken dependencies.</p>

	<p><strong> Since the released artifact has the same name as
	the development artifact, all developers MUST explicitly clear
	the old artifact from their local repository in order for
	future builds to use the released version of the artifact and
	not some historical revision of the same-named artifact.
	Failure to do this can lead to hidden suprises.  </strong></p>

	<p> Normally developers will simply switch to the new
	development version of the module, which can mask the
	problem.</p>
	
	<p> All in all, this issue is a bit kludgy and may need to be
	revisited.</p>

	</li>

   <li> Create the <strong> distribution artifacts </strong>
        ("m(n)dist").  This will generate the release files in
        target/distributions directory, including both source and
        binary artifacts.  The binary artifact includes the JAR and
        the generated javadocs. <strong> Any files that you have left
        lying around will be included in the source release, which can
        be embarrassing to say the least.  For this reason it is
        <i>RECOMMENDED</i> that you check out a clean copy
        <i>before</i> creating the distribution artifacts.</strong>
        Note that bigdata requires a 1.5 JVM.
        </li>

   <li> <p>Create an <strong> uberjar artifact </strong> ("m(n)uberjar")
        (iff required).  The uberjar will be created in the target
        directory.</p>

	<p>Most modules do NOT release uberjars, so this step is
        optional.  (An uberjar is a possibly executable JAR containing
        all dependencies for the project. Whether or not an uberjar
        makes sense and what it does when you execute it depends
        entirely the module in question.</p>
	
	<p>Note: You can check the <em>project.properties</em> file
        for the module when in doubt - an uberjar target exists iff
        the <em>maven.uberjar.main</em> property has been defined.</p>

	</li>

   <li> <strong> Tag the release </strong> in the CVS repository
        (e.g., "cvs rtag BIGDATA_0_1_B1 commons").  The tag name is
        the module name, e.g., "bigdata", and the module version.  All
        lower case letters are UPCASED and all whitespace and "-"
        characters are forced to underscores.  So, "bigdata" version
        "0.1-b1" is given the CVS Tag "BIGDATA_0_1_B1". (You can use
        this tag later in order to create a maintaince branch for this
        release.)</li>

   <li> <strong> Add &lt;version&gt; to POM </strong>.  You need to
        add a new &lt;version&gt; tag identifying this release in the
        &lt;versions&gt; section of the POM.  Each &lt;version&gt;
        element identifies a version of the module that can be
        reconstructed from the CVS repository using the identified
        tag.  For example:

<pre>
    &lt;version&gt;
       &lt;id&gt;0.1-b1-dev&lt;/id&gt;
       &lt;name&gt;0.1-b1&lt;/name&gt;
       &lt;tag&gt;BIGDATA_0_1_B1&lt;/tag&gt;
    &lt;/version&gt;
</pre>

   </li>

   <li> <strong> Update &lt;currentVersion&gt; in the POM. </strong>
        Before anything else happens, you need to bump the
        &lt;currentVersion&gt; in the "project.xml" file.  All future
        development will belong to this new module version.<br>

<pre>
For example:

&lt;currentVersion&gt;0.1-b1-dev&lt;/currentVersion&gt;

                    ||
                    ||
                    \/

&lt;currentVersion&gt;0.1-b2-dev&lt;/currentVersion&gt;
</pre>

   </li>

   <li> <strong> Commit modified "project.xml" </strong>.  This
        commits includes the new &lt;version&gt; element which
        identifies the release that you are making and the updated
        &lt;currentVersion&gt; element.

	<hr>

	Now that the module has been tagged (in CVS) and the module
	version has been updated (in the POM, which you just
	committed), anybody champing at the bit SHOULD be able to
	start work on the next release by updating ("cvs -update")
	their local source tree from CVS.  However it is probably a
	better idea to wait until you have deployed the new release
	just in case something comes up.

   </li>

   </ol>

<h3>Deploy to Maven Repository:</h3>

   <ol>

   <li> <p> <strong> Install artifacts in a public Maven repository.
        </strong> Since the bigdata modules use the Maven metabuild tool,
        the public releases MUST be propagated to a Maven repository.
        This is important since people will be able to auto-magically
        build maven-based projects that have a dependency on bigdata
        modules IFF those modules are available from a disclosed
        public repository.</p>

	<p> Getting artifacts installed on ibiblio is a manual process
        involving logging a JIRA request.  However, <em>the cognitive web
        project operates its own public Maven repository, which is being
        reused at this time to also publish bigdata artifacts</em>,
        which makes things considerably simpler.  The nightly build
        now places the most recent version of the main CVS branch to
        be installed into this repository.  For this reason, there MAY
        already be an artifact in the repository with the same name,
        but this represents the most recent snapshot build of the
        artifact you just released.  It MIGHT NOT be identical to the
        artifact that you just released, e.g., if you made any changes
        during the day of the release that were not reflected by the
        next nightly build using CVS.  So <strong>you MUST update the
        artifact so that it reflects the state of the JAR at the time
        that it was released to SourceForge.</strong>

	</p><pre>
	cd target

	md5sum.exe cweb-commons-1.1-b1-dev.jar &gt; cweb-commons-1.1-b1-dev.jar.md5

	scp cweb-commons-1.1-b1-dev.jar* username@proto.cognitiveweb.org:/home/groups/c/cw/cweb/maven-repository/org.CognitiveWeb/jars
	</pre>
    <p>

	Where <i>username</i> is your login name on that host.  Be
	sure to use the name of the artifact that you are releasing.
	The "jar*" notation is designed to upload both the JAR and the
	MD5 signature for the JAR.  <em>Make sure that you upload both
	the JAR and the MD5 signature!</em>
	
    </p>

	<p> <strong>Verify that the artifact is in the <a
	href="http://proto.cognitiveweb.org/maven-repository/org.CognitiveWeb">
	maven repository</a> </strong>.  The best way is to follow the
	link and verify that the artifact is now listed, download a
	copy, and verify that it is the right version, e.g., using the
	md5 checksum.
	</p>

	<p>Note: In order for a maven build to auto-magically obtain a
        bigdata module, it MUST list the public appropriate Maven repositories in
        its <code>project.properties</code> file.  For example:

	</p><pre>
	maven.repo.remote=http://mirrors.ibiblio.org/pub/mirrors/maven,http://proto.cognitiveweb.org/maven-repository
	</pre>
	<p>
	This has already been done for all the existing modules.
	</p>

	<p><strong>Does the release includes any <em>OPEN SOURCE</em>
	dependencies that are NOT released on the ibiblio Maven
	repository?</strong>.  If so, then these artifacts SHOULD be
	installed on a public Maven repository such that a
	Maven build can succeed auto-magically.  <strong>(Non-open
	source dependencies MUST NOT be deployed to the public
	repository since that can violate their license terms!!!)
	</strong></p>

	<p> This is a two step process.  First, the artifact can be
	copied to the local repository on the server per the
	example above.  However, if this is a new dependency group,
	then a system administrator MUST also create an appropriate
	symlink so that the artifact(s) in that dependency group will
	be exposed on the public Maven repository.</p>

	<p> Note: if the nightly build has been succeeding, then the
	required dependencies are already in either the ibiblio maven
	repository or the <a
	href="http://proto.cognitiveweb.org/maven-repository"> cweb
	maven repository</a>.  However, the cweb maven repository is
	part public and part private so that non-open source
	dependencies may be maintained for the purpose of the nightly
	builds.  (Non-open source dependencies are not symlinked to
	the public web site and therefore are not available to third
	parties.)  Therefore a successful nightly build does not mean
	that a third party will be able to do an auto-magic build if
	there are any non-open source dependencies.</p>

	</li>

   </ol>

<h3>Deploy to SourceForge:</h3>

   <ol>

   <li> <strong> Upload </strong> the release artifacts (<i>including
        the optional uberjar if one was generated</i>) to SourceForge.
        Upload is via anonymous ftp to <a
        href="ftp://upload.sourceforge.net/incoming">
        upload.sourceforge.net </a>.  The files need to be uploaded
        into the "incoming" directory on SourceForge.<br>

	Here is a sample FTP session:

<pre>

<strong>ftp upload.sourceforge.net</strong>
Connected to osdn.dl.sourceforge.net.
User (osdn.dl.sourceforge.net:(none)): <strong>anonymous</strong>
331 Anonymous login ok, <i>send your complete e-mail address as password.</i>
Password:
230 Anonymous access granted, restrictions apply.
ftp&gt; <strong>cd incoming</strong>
250 CWD command successful.
ftp&gt; <strong>bin</strong>
200 Type set to I.
ftp&gt; <strong>hash</strong>
Hash mark printing On  ftp: (2048 bytes/hash mark) .
ftp&gt; <strong>lcd target/distributions</strong>
Local directory now C:\usr\local\src\sql\target\distributions.
ftp&gt; <strong>!ls -l</strong>
total 175
-rwx------    1 thompson mkpasswd    15428 Jun  9 04:58 cweb-sql-1.1-b1-dev-src.tar.gz
-rwx------    1 thompson mkpasswd    25535 Jun  9 04:58 cweb-sql-1.1-b1-dev-src.zip
-rwx------    1 thompson mkpasswd    43238 Jun  9 04:58 cweb-sql-1.1-b1-dev.tar.gz
-rwx------    1 thompson mkpasswd    92703 Jun  9 04:58 cweb-sql-1.1-b1-dev.zip
ftp&gt; <strong>mput *</strong>
mput cweb-sql-1.1-b1-dev-src.tar.gz? <strong>y</strong>
200 PORT command successful.
150 Opening BINARY mode data connection for cweb-sql-1.1-b1-dev-src.tar.gz.
#######
226 Transfer complete.
ftp: 15428 bytes sent in 0.00Seconds 15428000.00Kbytes/sec.
mput cweb-sql-1.1-b1-dev-src.zip? <strong>y</strong>
200 PORT command successful.
150 Opening BINARY mode data connection for cweb-sql-1.1-b1-dev-src.zip.
############
226 Transfer complete.
ftp: 25535 bytes sent in 0.00Seconds 25535000.00Kbytes/sec.
mput cweb-sql-1.1-b1-dev.tar.gz? <strong>y</strong>
200 PORT command successful.
150 Opening BINARY mode data connection for cweb-sql-1.1-b1-dev.tar.gz.
#####################
226 Transfer complete.
ftp: 43238 bytes sent in 0.00Seconds 43238000.00Kbytes/sec.
mput cweb-sql-1.1-b1-dev.zip? <strong>y</strong>
200 PORT command successful.
150 Opening BINARY mode data connection for cweb-sql-1.1-b1-dev.zip.
#############################################
226 Transfer complete.
ftp: 92703 bytes sent in 3.20Seconds 29.02Kbytes/sec.
ftp&gt; <strong>bye</strong>
</pre>

   </li>

   <li> <strong> Create a release </strong> for the module using the
        <a
        href="https://sourceforge.net/project/admin/editpackages.php?group_id=95673">
        file release tools</a> on SourceForge.  Fill in the <strong>
        "release name" </strong> from the value of the
        &lt;currentVersion&gt; element in the POM <strong>before</strong>
        you modified it above (i.e., the version which was in development).
        The "-dev" extension is dropped, so <code>1.1-b2-dev</code> becomes
        <code>1.1-b2</code>.
        
        <p>
        <strong>The files
        are released as soon as you identify the artifacts in the
        incoming FTP directory on SourceForge. </strong> You can (and
        must) <strong>edit the release details</strong> as you go.
        For each released artifact, you will have to add some explicit
        metadata indicating what platform it supports, whether it is a
        source or binary release, etc.  You can also update a release
        after the fact if you have made some horrible mistake.  This
        topic gets a little bit complicated (you have to wait
        overnight for the incoming directory to get wiped), so read up
        on its at SourceForge. </p>
        
        </li>

   </ol>


<h3>Publicize:</h3>

<ol>

   <li> <strong> Publicize </strong> the release, including
        announcements on the appropriate mailing lists (user, and
        developer).

   </li>
   
   <li> Write up and <a href="http://sourceforge.net/news/submit.php?group_id=95673">
        post a news annoucement</a> on the project site on sourceforge.  See the <a
        href="./NEWS-HOWTO.txt"> NEWS HOWTO </a> for guidence and the <a
        href="http://sourceforge.net/news/?group_id=191861"> news archive </a>
        for examples.
        
   </li>

</ol>

<hr>

<h3>Commands</h3>

<p>

    The following command aliases are referenced above.  These make
    some assumption about the location of the source tree on the local
    file system.  There is generally a "m..." and an "mn..." version
    of each command - the latter does NOT run the unit tests.  This is
    very helpful when you need to release a module which has know test
    failures.<br></br>

    My position on releasing with known test failures is that it is
    Ok.  Sometimes you write tests that demonstrate broken features
    either of the module that you are releasing or of a dependency
    used by that module.  If your policy is to only release when all
    tests succeed, then you either are commenting out tests that fail
    or failing to write enough tests!

</p>

<pre>

alias msite="maven -Dmaven.war.filter.properties=c:/usr/local/src/build.properties -Dmaven.test.skip=true site"

alias mtest="maven -Dmaven.war.filter.properties=c:/usr/local/src/build.properties -Dmaven.test.skip=false test"
alias mtestui="maven -Dmaven.war.filter.properties=c:/usr/local/src/build.properties -Dmaven.test.skip=false test:ui"

alias mwar="maven -Dmaven.war.filter.properties=c:/usr/local/src/build.properties -Dmaven.test.skip=true war"

alias minstall="maven -Dmaven.war.filter.properties=c:/usr/local/src/build.properties -Dmaven.test.skip=false install"
alias mninstall="maven -Dmaven.war.filter.properties=c:/usr/local/src/build.properties -Dmaven.test.skip=true install"

alias mdist="maven -Dmaven.war.filter.properties=c:/usr/local/src/build.properties -Dmaven.test.skip=false dist:build"
alias mndist="maven -Dmaven.war.filter.properties=c:/usr/local/src/build.properties -Dmaven.test.skip=true dist:build"

alias muberjar="maven -Dmaven.war.filter.properties=c:/usr/local/src/build.properties -Dmaven.test.skip=false uberjar"
alias mnuberjar="maven -Dmaven.war.filter.properties=c:/usr/local/src/build.properties -Dmaven.test.skip=true uberjar"

</pre>

</body>
</html>